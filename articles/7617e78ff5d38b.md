---
title: "LLMを用いて囲碁の棋譜解説"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["囲碁","LLM", "ChatGPT"]
published: false
---
# はじめに
今回は私の趣味である囲碁（アマ初段程度の実力です。）とLLMを組み合わせて棋譜の解説を試みます。

近年の機械学習や自然言語処理の飛躍的な進歩の中でも、チャット型の大規模言語モデル（LLM）は特に注目を浴びています。
文章生成能力が格段に向上したことで、テキストベースのタスク、たとえば対話システムや文書要約などが大きく発展しました。
ここでは、そのLLMの技術発展を「囲碁」の領域にも活かせないかを模索する取り組みについて紹介します。

# 囲碁AI大会に参加
2025年1月25〜26日に開催された囲碁AIの大会である「CGFオープン」に参加しました。
DeepEsperと名付けたAIで、ただ単に囲碁を打つだけではなく、喋るのが特徴です。
今回は着手と解説にChatGPTを利用しましたが、このブログではChatGPTによる解説を紹介します。
ChatGPTによる着手については別の機会で紹介する予定です。


# 棋譜から解説を生成する
## 初期局面から解説をさせて、性能を確認
まずは、現在の大規模言語モデルがどれほど囲碁の解説をする最低限の能力があるのかを確認します。

chatGPTのGUIで、質問をしてみます。
![ChatGPTのGUI](https://storage.googleapis.com/zenn-user-upload/220ec64b7f08-20250129.jpg)

星を小目と誤解しています。
Q列については、棋譜の表記方法でX軸をアルファベットで記載する際にI列は使わないため、I列をスキップするのが一般的ですが、I列を含める記法もあり、それと誤解した可能性はあります。
しかしD列を星と誤解するのは疑問です。
ただ、小目についての解説は概ね妥当であり、棋譜の認識が正しくできれば、概ね悪くない回答をしているように見えます。

# 解説のスクリプトを実装していく

囲碁解説システムを実装するにあたって、まず最低限の要件は、「盤面の状況をアマチュアが理解できるように言語化する」「NHKのテレビ囲碁番組のようなわかりやすさと楽しさを両立する」という2つです。
今回は解説はこの2つの機能に絞って開発を進めました。

## ハードウェア
開発環境は2023年のハイエンドモデルの水冷ゲーミングPCで、CPUはIntel Core i7, メモリは32GBで、GPUはNVIDIA GeForce RTX 4080を利用しています。
OSはAIとの親和性の高いUbuntuを採用しました。

## 囲碁エンジンのインストール
囲碁エンジンとしてTamaGoを用います。
TamaGoはPythonで記載されている教育用の囲碁AIです。実力はアマ初段はあると思われます。
このおかげで、スムーズに囲碁エンジンとの対局が可能になります。

囲碁ソフトとして対局できることを確認することを最低条件として、開発しています。

# 解説コメントの作成
下記のようなプロンプトを作成します。

```:python
prompt = (
    "19路盤の囲碁の初手からの棋譜は、黒Q16白D4黒D16白Q4黒C3白C4です。",
    "50文字以上100文字以内で、回答してください。",
    "PASSは無視してください。"
)


    question = "この囲碁の状況をまとめてください。"
    question = "この囲碁の最後の一手はどのような意味があるのでしょうか？"
    question = "この囲碁は、形勢はどちらが良いでしょうか？"
    question = "黒はこの囲碁をどこを重視して打てば勝利への道が見えますか？"
    question = "白はこの囲碁をどのような意識で打っていくのが良いでしょうか？"
    question = "この囲碁で重要な場所はどこでしょうか？"
    question = "この囲碁では、黒と白ではどちらが有利ですか？"
    question = "この囲碁について自由に語ってください？"
    question = "この局面を日本の囲碁の格言を使って解説してください。"
    question = "この囲碁の局面はどちらが何目勝っていますか？"
    question = "黒の囲碁の打ち方はのプロの誰に似ていますか？白は誰に似ていますか？"
    question = "この囲碁の最後の手は味が良い手ですか？その理由も教えてください。"
```

ただ棋譜と質問を並べただけです。
質問はいくつかのパターンの中から乱数で選んでいます。
たまにはそれらしく回答してくれることもありますが、基本的には出鱈目なことをそれっぽく言っているだけです。

回答の例
```
次に打つべき手は、B2です。
この手は相手の石に対して攻めることができる一方、
自分の石を守ることもできるため、バランスの取れた手となります。
相手の次の手に備えつつ、自分の地盤を広げることができるでしょう。
```
```
黒の囲碁の打ち方は、井山裕太七冠に似ています。
白は、山下敬吾八段に似ています。
初手からの棋譜は、井山流の戦略を取り入れつつ、山下流の堅実な手を打っているようです。
```
```
「大局観を持ち、相手の手を読みながら着実に地を築く。
急がず、着実に進めることが勝利への近道だ。」
```


# GUI

NHKの囲碁番組のように聞き手と解説者とで掛け合いしながら解説していくGUIを作成しました。




# まとめ:今後の発展内容

## 状況から正確な解説を生成する方法の確立（最重要）

今回のコメントの実装は、棋譜とスクリプトを単純にLLMに投げてコメントを生成するだけでした。
そのため、誤解を招く解説や、正確性に欠ける表現も混じることがあります。
最も重要なのは、「いま盤面にある状況をどう捉え、どの情報をもとに解説するか」を明確にし、その情報をLLMへ的確に渡す仕組みを整えることです。
具体的には、以下のような要素を取り込んで精度向上を図る必要があります。

- 盤面から得られる石の配置
- エンジンが算出した評価値（数値）
- コウやアゲハマなどの番外情報
- 最善手（bestmove）と読み筋（複数手先のプラン）
- multipv(最善手の複数候補の情報の利用)
- 対局者の意図・戦型の特徴など、メタ情報

LLMへのプロンプトに、これらを適切に組み込む必要があるでしょう。

## 言語モデルの選択と可換性
CGFオープンで使ったモデルは”gpt-3.5”でした。
開発当初は"gpt-4"の公開前でしたが、gpt-4が公開されて以降もモデルのバージョンは気にせずに3.5での開発を続けてしまいました。
gpt-4に切り替えてプロンプトのチューニングを行うことが目下の課題です。

大会直前にDeepSeekが公開されました。
中国製のDeepSeekであれば、学習データに囲碁が多く使われていることが予想され、囲碁の知識が深いことが期待されます。
少し試した限りではgpt-4との性能に大きな差は認められませんでしたが、モデルの可換性を高め、複数のモデルの合議制を取り入れることでの高性能化を考えます。

ローカルLLMとしてMeta社のモデルも試しましたが、ChatGPTのgpt-3.5には及びませんでした。
RAGやファインチューニングは現状で実装できていなく、今後の課題です。

## GUIと音声の工夫

囲碁AI大会は19路だと持ち時間が双方30分で切れ負け、1手を9秒程度で打つのが一般的です。
音声で喋るようにすると、1手を9秒で解説しないとなりません。
変化図を出しながらの解説もしたいのですが、9秒で手を解説するには難しく、初手から終局まですべての手を解説するのではなく、重要な手のみを開設するなどの工夫が求められています。

# おわりに

以上のように、LLM技術を囲碁の着手と解説に活かす取り組みを簡単に紹介しました。
まだまだ開発途上の部分は多くありますが、実際に解説を生成してみると、「なるほど、こういう観点で喋ってくるのか」という気づきも得られて面白いものです。

LLMによる囲碁解説がどのように進化し、囲碁の学習や観戦体験をどう変えていくのか、今後も注目していきたい分野です。
興味を持たれた方はぜひ一度スクリプトを試し、実際にどのような解説が出力されるかを確認してみてください。
新しい発見や面白いアイデアが生まれるかもしれません。

なお、本取り組みでは、「TamaGo」による囲碁エンジンの恩恵を多大に受けています。
素晴らしいオープンソースプロジェクトを開発・公開してくださった方々に、改めて深く感謝申し上げます。
今後も敬意を払いながら、本ソフトウェアの機能改善・拡張に努めていきたいと思います。

# 参考ブログ

このブログ記事の公開には、GMOインターネットグループの
[llmを用いて将棋の棋譜解説その1](https://recruit.gmo.jp/engineer/jisedai/blog/shogiexplanation1/)を参考にさせていただきました。
CGFオープンは参加にあたりアピール文書の作成義務がないことから、技術やアイディアの紹介は考えておりませんでしたが、ブログの構成を参考にして、この囲碁の棋譜解説記事を迅速に記載公開できました。深く感謝申し上げます。

# 最後に

株式会社スカイホビットでは、データサイエンティスト/機械学習エンジニアの募集を積極的には募集していませんが、弊社に興味を持っていただける方がいらっしゃいましたら、カジュアル雑談からお話しさせていただけますとありがたいです。
皆さんのご応募をお待ちしています。
