---
title: "LLMを用いて囲碁の棋譜解説"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["囲碁","LLM", "ChatGPT"]
published: true
---
# はじめに
今回は私の趣味である囲碁（アマ初段程度の実力です．）とLLMを組み合わせて棋譜の解説を試みます．

近年の機械学習や自然言語処理の飛躍的な進歩の中でも，チャット型の大規模言語モデル（LLM）は特に注目を浴びています．
文章生成能力が格段に向上したことで，テキストベースのタスク，たとえば対話システムや文書要約などが大きく発展しました．
ここでは，そのLLMの技術発展を「囲碁」の領域にも活かせないかを模索する取り組みについて紹介します．

# 囲碁AI大会に参加
2025年1月25〜26日に開催された囲碁AIの大会である「CGFオープン」に参加しました．
DeepEsperと名付けたAIで，ただ単に囲碁を打つだけではなく，喋るのが特徴です．
このブログではChatGPTによる解説を紹介します．
ChatGPTによる着手については別の機会で紹介する予定です．


# 棋譜から解説を生成する
## 初期局面から解説をさせて，性能を確認
まずは，現在の大規模言語モデルがどれほど囲碁の解説をする最低限の能力があるのかを確認します．

chatGPTのGUIで，質問をしてみます．
![ChatGPTのGUI](https://storage.googleapis.com/zenn-user-upload/220ec64b7f08-20250129.jpg)

星を小目と誤解しています．
Q列については，棋譜の表記方法でX軸をアルファベットで記載する際にI列は使わないため，I列をスキップするのが一般的ですが，I列を含める記法もあり，それと誤解した可能性はあります．
しかしD列を星と誤解するのは疑問です．
ただ，小目についての解説は概ね妥当であり，棋譜の認識が正しくできれば，概ね悪くない回答をしているように見えます．

# 解説のスクリプトを実装していく

囲碁解説システムを実装するにあたって，まず最低限の要件は，「盤面の状況をアマチュアが理解できるように言語化する」「NHKのテレビ囲碁番組のようなわかりやすさと楽しさを両立する」という2つです．
今回は解説はこの2つの機能に絞って開発を進めました．

## ハードウェア
開発環境は2023年のハイエンドモデルのゲーミングPCで，CPUはIntel Core i7, メモリは32GBで，GPUはNVIDIA GeForce RTX 4080を利用しています．
OSはAIとの親和性の高いUbuntuを採用しました．

## 囲碁エンジンのインストール
囲碁エンジンとしてTamaGoを用います．
TamaGoはPythonで記載されている教育用の囲碁AIです．実力はアマ初段はあると思われます．
このおかげで，スムーズに囲碁エンジンとの対局が可能になります．

囲碁ソフトとして対局できることを確認することを最低条件として，開発しています．

# 解説コメントの作成
下記のようなプロンプトを作成します．

```:python
prompt = (
    "19路盤の囲碁の初手からの棋譜は，黒Q16白D4黒D16白Q4黒C3白C4です．",
    "50文字以上100文字以内で，回答してください．",
    "PASSは無視してください．"
)


"この囲碁の状況をまとめてください．"
"この囲碁の最後の一手はどのような意味があるのでしょうか？"
"この囲碁は，形勢はどちらが良いでしょうか？"
"この囲碁の最後の3手くらいについてを特に重点的に解説してください．"
"黒はこの囲碁をどこを重視して打てば勝利への道が見えますか？"
"白はこの囲碁をどのような意識で打っていくのが良いでしょうか？"
"この囲碁で重要な場所はどこでしょうか？"
"この囲碁では，黒と白ではどちらが有利ですか？"
"この囲碁について自由に語ってください？"
"この囲碁で，黒の最も重要な石を一つだけ教えてください．その理由も教えてください．"
"この囲碁で，白の最も重要な石を一つだけ教えてください．その理由も教えてください．"
"この局面を日本の囲碁の格言を使って解説してください．"
"この囲碁の局面はどちらが何目勝っていますか？"
"黒の囲碁の打ち方はのプロの誰に似ていますか？白は誰に似ていますか？"
"この囲碁の局面で，次に打つ場所はどこですか？A1やE5のようにアルファベットと数値の座標で回答してください．"
"この囲碁の最後の手は味が良い手ですか？その理由も教えてください．"
```

ただ棋譜と質問を並べただけです．
質問はいくつかのパターンの中からランダムで選んでいます．
たまにはそれらしく回答してくれることもありますが，出鱈目なことをそれっぽく言っています．

回答の例
```
次に打つべき手は，B2です．
この手は相手の石に対して攻めることができる一方，
自分の石を守ることもできるため，バランスの取れた手となります．
相手の次の手に備えつつ，自分の地盤を広げることができるでしょう．
```
```
黒の囲碁の打ち方は，井山裕太七冠に似ています．
白は，山下敬吾八段に似ています．
初手からの棋譜は，井山流の戦略を取り入れつつ，山下流の堅実な手を打っているようです．
```
```
「大局観を持ち，相手の手を読みながら着実に地を築く．
急がず，着実に進めることが勝利への近道だ．」
```
```
白は相手の石に対して攻めるよりも，まずは自分の地を確保することが重要です．
初手から相手の石に対して積極的に攻めるよりも，まずは自分の地を広げることを意識して打っていくと良いでしょう．
```
```
この囲碁の形勢は，黒がやや有利です．
黒の石が中央に広がり，白の石を圧迫しています．
ただし，白もまだ逆転の余地があります．
白は中央に厚みを持たせることで形勢を逆転させる可能性があります．
```

# GUIと音声

NHKの囲碁番組のように聞き手と解説者とで掛け合いしながら解説していくGUIを作成しました．
![DeepEsper GUI](https://storage.googleapis.com/zenn-user-upload/ab6ddba4632b-20250131.jpg)
音声も読み上げるようにしました．
テレビの囲碁中継を観るように楽しめます．

# まとめ:今後の発展内容

## 状況から正確な解説を生成する方法の確立（最重要）

今回のコメントの実装は，棋譜とスクリプトを単純にLLMに投げてコメントを生成するだけでした．
そのため，誤解を招く解説や，正確性に欠ける表現も混じることがあります．
最も重要なのは，「いま盤面にある状況をどう捉え，どの情報をもとに解説するか」を明確にし，その情報をLLMへ的確に渡す仕組みを整えることです．
具体的には，以下のような要素を取り込んで精度向上を図る必要があります．

- 盤面から得られる石の配置
- エンジンが算出した評価値（数値）
- コウやアゲハマなどの番外情報
- 最善手（bestmove）と読み筋（複数手先のプラン）
- multipv(最善手の複数候補の情報の利用)
- 対局者の意図・戦型の特徴など，メタ情報

LLMへのプロンプトに，これらを適切に組み込む必要があるでしょう．

## 言語モデルの選択と可換性
CGFオープンで使ったモデルは”gpt-3.5”でした．
開発当初は"gpt-4"の公開前でしたが，gpt-4が公開されて以降もモデルのバージョンは気にせずに3.5での開発を続けてしまいました．
gpt-4に切り替えてプロンプトのチューニングを行うことが目下の課題です．

大会直前にDeepSeekが公開されました．
中国製のDeepSeekであれば，学習データに囲碁が多く使われていることが予想され，囲碁の知識が深いことが期待されます．
少し試した限りではgpt-4との性能に大きな差は認められませんでしたが，モデルの可換性を高め，複数のモデルの合議制を取り入れることでの高性能化を考えます．

ローカルLLMとしてMeta社のモデルも試しましたが，ChatGPTのgpt-3.5には及びませんでした．
RAGやファインチューニングは現状で実装できていなく，今後の課題です．

## GUIと音声の工夫

囲碁AI大会は19路だと持ち時間が双方30分で切れ負け，1手を9秒程度で打つのが一般的です．
音声で喋るようにすると，1手を9秒で解説しないとなりません．
変化図を出しながらの解説もしたいのですが，9秒で手を解説するには難しく，初手から終局まですべての手を解説するのではなく，重要な手のみを開設するなどの工夫が求められています．

## 棋力応じた解説内容の変更
級位者や入門者に対して深い読み筋を解説しても理解はできませんし，高段者に基礎的な説明をしても冗長に感じられて退屈でしょう．
雑談を多めにするか盤面の解説を重視するかも視聴者の興味関心により異なります．
テレビ放送やネット配信ではボリュームゾーン向けの解説しかできませんが，視聴者にあわせて解説内容を変えるのはソフトウェアによる解説ならではの利点です．
プロ棋士や囲碁インストラクターは指導碁で相手の棋力に応じて着手や指導碁後のコメントを変えられていますが，そのような機能を実現したいと考えます．

# おわりに

以上のように，LLM技術を囲碁の着手と解説に活かす取り組みを簡単に紹介しました．
まだまだ開発途上の部分は多くありますが，実際に解説を生成してみると，「なるほど，こういう観点で喋ってくるのか」という気づきも得られて面白いものです．

LLMによる囲碁解説がどのように進化し，囲碁の学習や観戦体験をどう変えていくのか，今後も注目していきたい分野です．
興味を持たれた方はぜひ一度スクリプトを試し，実際にどのような解説が出力されるかを確認してみてください．
新しい発見や面白いアイデアが生まれるかもしれません．

なお，本取り組みでは，多くのアイディアを参考にさせていただいております．
LLMによる解説のアイディアは，日本視覚障害者囲碁協会のブログ記事『[ChatGPTを使った囲碁勉強法について](https://note.com/aigo_tokyo/n/nc91bad2f09a4)』にAIによる囲碁学習の可能性が書かれており，参考にさせていただきました．
スクリプト中の棋風をプロ棋士に例えるのは，野狐囲碁の棋風診断機能を参考にしています．
囲碁エンジン部分は「TamaGo」による恩恵を多大に受けています．
本ブログ記事の執筆は，『[llmを用いて将棋の棋譜解説 その1](https://recruit.gmo.jp/engineer/jisedai/blog/shogiexplanation1)』を参考にさせていただきました．
素晴らしい成果を開発・公開してくださった方々に，改めて深く感謝申し上げます．
今後も敬意を払いながら，本ソフトウェアの機能改善・拡張に努めていきたいと思います．
